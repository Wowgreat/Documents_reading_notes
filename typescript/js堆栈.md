### 引用数据类型是什么？

引用数据类型是指由类型的实际值引用（类似于指针）表示的数据类型。如果为某个变量分配一个引用类型，则该变量将引用（或“指向”）原始值。不创建任何副本。引用类型包括类、接口、委托和装箱值类型。



### 引用数据类型的概念

“引用”（reference）是c++的一种新的变量类型，是对C的一个重要补充。它的作用是为变量起一个别名。假如有一个变量a，想给它起一个别名，可以这样写：

```c
int a;int &b=a;
```

这就表明了b是a的“引用”，即a的别名。经过这样的声明，使用a或b的作用相同，都代表同一变量。在上述引用中，&是“引用声明符”，并不代表地址。



### 引用与指针的区别

```c
int m;
int &n = m
# n 相当于m的别名,对n的任何操作就是对m的操作,所以n既不是m的拷贝，也不是指向m的指针，其实n就是m它自己。
```



### 堆内存与栈内存

#### 栈内存

一般储存基础数据类型

```javascript
var a=1
```

数据在栈内存中的存储与使用方式类似于数据结构中的堆栈数据结构，遵循**后进先出**的原则。

#### 堆内存

堆内存一般储存引用数据类型

```javascript
var b = { xi : 20 }
```

与其他语言不同，js的引用数据类型，比如数组Array，它们值的大小是不固定的。引用数据类型的值是保存在堆内存中的对象。**js不允许直接访问堆内存中的位置**，因此我们不能直接操作对象的堆内存空间。



### 浏览器时间机制

![image-20210112160653005](imgs\1.jpg)



对象放在heap（堆）里，常见的基础类型和函数放在stack（栈）里，函数执行的时候在栈里执行。栈里函数执行的时候可能会调一些Dom操作，ajax操作和setTimeout定时器，这时候要等stack（栈）里面的所有程序先走**（注意：栈里的代码是先进后出）**，走完后再走WebAPIs，WebAPIs执行后的结果放在callback queue（回调的队列里，注意：队列里的代码先放进去的先执行），也就是当栈里面的程序走完之后，再从任务队列中读取事件，将队列中的事件放到执行栈中依次执行，这个过程是循环不断的。

- 所有同步任务都在主线程上执行，形成一个执行栈
- 主线程之外，还存在一个任务队列。**只要异步任务有了运行结果，就在任务队列之中放置一个事件。**
- 一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列,将队列中的事件放到执行栈中依次执行
- .主线程从任务队列中读取事件，这个过程是循环不断的



### 宏任务vs微任务

一个例子

```js
console.log('1');

setTimeout(function() {
  console.log('setTimeout');
}, 0);

Promise.resolve().then(function() {
  console.log('promise1');
}).then(function() {
  console.log('promise2');
});

console.log('2');

//  输出结果: 1 2 promise1 promise2 setTimeout
```

#### 宏任务

浏览器为了能够使得JS内部宏任务与DOM任务能够有序的执行，会在一个task执行结束后，在下一个 task 执行开始前，对页面进行重新渲染 （task->渲染->task->…） 鼠标点击会触发一个事件回调，需要执行一个宏任务，然后解析HTMl。但是，**setTimeout不一样**，**setTimeout的作用是等待给定的时间后为它的回调产生一个新的宏任务**。这就是为什么打印`setTimeout`在`promise1` , `promise2`之后。因为打印`promise1` , `promise2`是第一个宏任务里面的事情，而`setTimeout`是**另一个新的独立的**任务里面打印的。

#### 微任务

微任务通常来说就是需要在当前 task 执行结束后立即执行的任务 比如对一系列动作做出反馈，或者是需要异步的执行任务而又不需要分配一个新的 task，这样便可以**减小一点性能的开销**。只要执行栈中没有其他的js代码正在执行且每个宏任务执行完，微任务队列会立即执行。如果在微任务执行期间微任务队列加入了新的微任务，会将新的微任务加入队列尾部，之后也会被执行。

